<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futbol KrallÄ±ÄŸÄ± (SÃ¼per Stabil Versiyon)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        /*
            SAVUNMA MEKANÄ°ZMASI #1: CSS'in en temel halleri bile Ã§alÄ±ÅŸmazsa diye
            HTML ve BODY etiketlerine doÄŸrudan stil vererek baÅŸlÄ±yoruz.
        */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }

        /* TEMA DEÄžÄ°ÅžKENLERÄ° */
        :root {
            --bg-solid: #1a2a33; /* SAVUNMA MEKANÄ°ZMASI #2: Gradyan Ã§alÄ±ÅŸmazsa diye dÃ¼z renk */
            --bg-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            --text-color: #ffffff;
            --card-bg: rgba(255, 255, 255, 0.1);
            --border-color: rgba(255, 255, 255, 0.2);
            /* DiÄŸer renkler... */
            --primary-color: #1a73e8;
            --accent-color: #00e676;
        }
        [data-theme='light'] {
            --bg-solid: #f4f4f4;
            --bg-gradient: linear-gradient(135deg, #e9e9e9 0%, #ffffff 100%);
            --text-color: #2c3e50;
            --card-bg: rgba(0, 0, 0, 0.05);
            --border-color: rgba(0, 0, 0, 0.1);
            --primary-color: #0052d4;
            --accent-color: #00b894;
        }

        body {
            background-color: var(--bg-solid) !important; /* SAVUNMA MEKANÄ°ZMASI #3: !important kuralÄ± */
            background-image: var(--bg-gradient) !important;
            color: var(--text-color) !important;
            transition: background 0.5s ease, color 0.5s ease;
        }

        .game-view {
            display: none; width: 100%; height: 100%;
            padding: 20px; box-sizing: border-box;
            animation: fadeIn 0.5s ease; position: absolute;
            top: 0; left: 0; overflow-y: auto;
        }
        .game-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ArayÃ¼z stilleri Ã¶ncekiyle bÃ¼yÃ¼k Ã¶lÃ§Ã¼de aynÄ±, okunabilirlik iÃ§in kÄ±saltÄ±ldÄ± */
        #menu-view { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .main-title { font-size: 4em; font-weight: bold; text-shadow: 0 0 20px var(--accent-color); margin-bottom: 20px; }
        .menu-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 600px; }
        .menu-btn { background: var(--card-bg); border: 2px solid var(--border-color); color: var(--text-color); padding: 25px; font-size: 1.5em; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(5px); }
        .menu-btn:hover { background-color: var(--primary-color); border-color: var(--primary-color); transform: translateY(-5px); }
        .top-bar-element { position: fixed; z-index: 10; background: var(--card-bg); color: var(--text-color); padding: 10px 20px; border-radius: 20px; font-size: 1.2em; border: 1px solid var(--border-color); backdrop-filter: blur(5px); display: none; }
        #currency-display { top: 20px; right: 20px; }
        #back-to-menu { top: 20px; left: 20px; cursor: pointer; }
        .page-content { max-width: 900px; margin: 80px auto 20px auto; padding: 20px; border-radius: 15px; }
        .player-list { list-style: none; padding: 0; }
        .player-item { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.1); padding: 15px; margin-bottom: 10px; border-radius: 10px; }
        #match-view-3d { padding: 0; }
    </style>
</head>
<body data-theme="dark">

    <noscript>
        <h1>JavaScript bu oyunu Ã§alÄ±ÅŸtÄ±rmak iÃ§in gereklidir. LÃ¼tfen tarayÄ±cÄ±nÄ±zda JavaScript'i etkinleÅŸtirin.</h1>
    </noscript>

    <div id="game-container" style="visibility: hidden;"> <div id="currency-display" class="top-bar-element">ðŸ’° Coins: <span id="coin-balance">1000</span></div>
        <div id="back-to-menu" class="top-bar-element">&lt; MenÃ¼ye DÃ¶n</div>

        <div id="menu-view" class="game-view">
            <h1 id="main-title" class="main-title">FUTBOL KRALLIÄžI</h1>
            <div class="menu-buttons">
                <button class="menu-btn" data-view="packs-view">Paketler</button>
                <button class="menu-btn" data-view="squad-view">Kadro</button>
                <button class="menu-btn" data-view="match-view-3d">MaÃ§ Yap</button>
                <button class="menu-btn" data-view="ayarlar-view">Ayarlar</button>
            </div>
        </div>
        
        <div id="packs-view" class="game-view">
             <div class="page-content">
                <h2>Paket DÃ¼kkanÄ±</h2>
                <p>Yeni bir oyuncu keÅŸfetmek iÃ§in paket aÃ§!</p>
                <button id="open-pack-btn" style="padding:15px 30px; font-size:1.2em">Oyuncu Paketi AÃ§ (50 Coin)</button>
                <div id="pack-results" style="margin-top: 20px; min-height: 150px;"></div>
            </div>
        </div>

        <div id="squad-view" class="game-view">
            <div class="page-content">
                <h2>TakÄ±m Kadrosu</h2>
                <ul id="squad-player-list" class="player-list"></ul>
            </div>
        </div>

        <div id="ayarlar-view" class="game-view">
            <div class="page-content">
                <h2>Ayarlar</h2>
                <h3>Tema SeÃ§imi</h3>
                <div id="theme-options">
                    <button data-theme="dark">Koyu Tema</button>
                    <button data-theme="light">AÃ§Ä±k Tema</button>
                </div>
            </div>
        </div>
        
        <div id="match-view-3d" class="game-view">
            <canvas id="threejs-canvas"></canvas>
        </div>
    </div>
    
    <script>
        // SAVUNMA MEKANÄ°ZMASI #4: TÃ¼m kodlarÄ± try-catch bloÄŸuna alÄ±yoruz.
        // Bu, herhangi bir JS hatasÄ± olursa oyunun tamamen Ã§Ã¶kmesini engeller
        // ve kullanÄ±cÄ±ya bir hata mesajÄ± gÃ¶sterir.
        try {
            document.addEventListener('DOMContentLoaded', () => {
                //--- GÃœVENLÄ°K: Elementlerin varlÄ±ÄŸÄ±nÄ± kontrol et ---
                const getEl = (id) => document.getElementById(id);
                const gameContainer = getEl('game-container');
                if (!gameContainer) throw new Error('Oyun ana konteyneri bulunamadÄ±!');

                const elements = {
                    body: document.body,
                    coinBalance: getEl('coin-balance'),
                    menuButtons: document.querySelectorAll('.menu-btn'),
                    gameViews: document.querySelectorAll('.game-view'),
                    currencyDisplay: getEl('currency-display'),
                    backToMenuBtn: getEl('back-to-menu'),
                    openPackBtn: getEl('open-pack-btn'),
                    packResults: getEl('pack-results'),
                    squadPlayerList: getEl('squad-player-list'),
                    mainTitle: getEl('main-title'),
                    themeOptions: getEl('theme-options')
                };

                //--- Oyun Verileri ---
                const gameState = { coins: 1000, roster: [] };
                
                //--- Ayarlar ---
                function applyTheme(themeName) {
                    if (elements.body) {
                        elements.body.dataset.theme = themeName;
                        localStorage.setItem('game_theme', themeName);
                        elements.themeOptions.querySelectorAll('button').forEach(btn => {
                            btn.style.backgroundColor = btn.dataset.theme === themeName ? 'var(--accent-color)' : 'transparent';
                        });
                    }
                }

                function loadSettings() {
                    const savedTheme = localStorage.getItem('game_theme') || 'dark';
                    applyTheme(savedTheme);
                }

                //--- Oyuncu Listesi ---
                function renderRosterList(targetElement) {
                    if (!targetElement) return;
                    targetElement.innerHTML = '';
                    if (gameState.roster.length === 0) {
                        targetElement.innerHTML = '<li class="player-item">HiÃ§ oyuncun yok. Paket aÃ§!</li>';
                        return;
                    }
                    gameState.roster.forEach(player => {
                        targetElement.innerHTML += `<li class="player-item"><div><strong>${player.name}</strong></div><div>${player.ovr}</div></li>`;
                    });
                }

                //--- Genel Fonksiyonlar ---
                const switchView = (viewId) => {
                    elements.gameViews.forEach(view => view.classList.remove('active'));
                    const newView = getEl(viewId);
                    if (newView) newView.classList.add('active');
                    
                    const isMenu = viewId === 'menu-view';
                    elements.currencyDisplay.style.display = isMenu ? 'none' : 'block';
                    elements.backToMenuBtn.style.display = isMenu ? 'none' : 'block';
                    
                    if (viewId === 'squad-view') renderRosterList(elements.squadPlayerList);
                    if (viewId === 'match-view-3d' && !window.threeJsInitialized) initThreeJS();
                };
                
                //--- Paket AÃ§ma ---
                function openPack() {
                    if (gameState.coins < 50) { alert('Yetersiz Bakiye!'); return; }
                    gameState.coins -= 50;
                    if(elements.coinBalance) elements.coinBalance.textContent = gameState.coins;
                    
                    const player = { name: "Oyuncu " + (gameState.roster.length + 1), ovr: Math.floor(Math.random() * 40) + 55 };
                    gameState.roster.push(player);

                    if(elements.packResults) {
                        elements.packResults.innerHTML = `<div class="player-item" style="justify-content:center;">Yeni Oyuncu: <strong>${player.name} (${player.ovr})</strong></div>`;
                    }
                }

                //--- 3D Sahne ---
                function initThreeJS() {
                    window.threeJsInitialized = true;
                    const canvas = getEl('threejs-canvas');
                    if(!canvas) return;

                    const scene = new THREE.Scene();
                    scene.background = new THREE.Color(0x87ceeb);
                    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                    camera.position.set(0, 15, 30);
                    scene.add(new THREE.AmbientLight(0xffffff, 0.7));
                    const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    const controls = new THREE.OrbitControls(camera, renderer.domElement);
                    const animate = () => { requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); };
                    animate();
                }

                //--- Olay Dinleyicileri ---
                elements.menuButtons.forEach(button => button.addEventListener('click', () => switchView(button.dataset.view)));
                if (elements.backToMenuBtn) elements.backToMenuBtn.addEventListener('click', () => switchView('menu-view'));
                if (elements.openPackBtn) elements.openPackBtn.addEventListener('click', openPack);
                if (elements.themeOptions) elements.themeOptions.addEventListener('click', (e) => {
                    if(e.target.tagName === 'BUTTON') applyTheme(e.target.dataset.theme);
                });

                //--- OYUNU BAÅžLAT ---
                loadSettings();
                if (elements.coinBalance) elements.coinBalance.textContent = gameState.coins;
                switchView('menu-view');
                gameContainer.style.visibility = 'visible'; // Her ÅŸey hazÄ±r, oyunu gÃ¶ster
            });
        } catch (error) {
            // EÄŸer herhangi bir hata olursa, kullanÄ±cÄ±ya gÃ¶ster.
            document.body.innerHTML = `<div style="padding: 20px; color: red; background: white;">
                <h1>Kritik Hata!</h1>
                <p>Oyun yÃ¼klenirken bir sorun oluÅŸtu. LÃ¼tfen sayfayÄ± Ctrl+Shift+R ile yeniden yÃ¼klemeyi deneyin.</p>
                <p>Hata DetayÄ±: ${error.message}</p>
            </div>`;
            console.error("Oyun HatasÄ±:", error);
        }
    </script>
</body>
</html>
